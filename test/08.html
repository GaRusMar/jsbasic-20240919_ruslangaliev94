<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8"/>
    <title>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã JavaScript ‚Äî –†–∞–±–æ—Ç–∞ —Å —Ñ–æ—Ä–º–∞–º–∏ –∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏</title>
    <style>
        .loader {
            display: none;
            font-size: 14px;
            line-height: 1;
            font-weight: 700;
            color: #bada55;
        }
    </style>
</head>
<body>

<h1>–ò–∑—É—á–∞–µ–º —Å–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤ JavaScript</h1>
<p>–ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã —Å <strong>fetch</strong>, <strong>FormData</strong> –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞.</p>

<span class="loader">–ó–∞–≥—Ä—É–∑–∫–∞...</span>

<!-- ==================== –†–∞–∑–¥–µ–ª 1. GET-–∑–∞–ø—Ä–æ—Å ==================== -->

<form action="https://httpbin.org/get" id="getForm">
    <button type="submit">–ó–∞–≥—Ä—É–∑–∏—Ç—å IP-–∞–¥—Ä–µ—Å</button>
    <span id="ip"></span>
</form>

<script>
    // üéì –ü—Ä–∏–º–µ—Ä 1: GET-–∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ fetch
    // ---------------------------------------------------------------
    const loader = document.querySelector('.loader');
    const getForm = document.querySelector('#getForm');
    const ipEl = document.querySelector('#ip');

    getForm.addEventListener('submit', event => {
        event.preventDefault(); // –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loader.style.display = 'block'; // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–ª–æ–∞–¥–µ—Ä

        fetch('https://httpbin.org/get')
            .then(response => {
                console.log('response:', response);
                const contentType = response.headers.get('content-type');
                console.log('Content-Type:', contentType);

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—Ç–≤–µ—Ç
                if (contentType && contentType.includes('json')) {
                    return response.json();
                } else {
                    return response.text();
                }
            })
            .then(data => {
                console.log('data:', data);
                ipEl.textContent = data.origin; // –≤—ã–≤–æ–¥–∏–º IP-–∞–¥—Ä–µ—Å
            })
            .finally(() => {
                loader.style.display = 'none'; // —Å–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–ª–æ–∞–¥–µ—Ä
            });
    });
</script>

<hr>

<!-- ==================== –†–∞–∑–¥–µ–ª 2. POST-–∑–∞–ø—Ä–æ—Å ==================== -->

<h2>–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä</h2>

<form id="postForm" action="https://httpbin.org/post" method="POST">
    <label>
        Email:
        <input type="text" autocomplete="off" name="email">
    </label>

    <label>
        –ü–∞—Ä–æ–ª—å:
        <input type="password" autocomplete="off" name="password">
    </label>

    <button type="submit">Sign up</button>
</form>

<script>
    // üéì –ü—Ä–∏–º–µ—Ä 2: POST-–∑–∞–ø—Ä–æ—Å —Å FormData
    // ---------------------------------------------------------------
    const postForm = document.querySelector('#postForm');

    postForm.addEventListener('submit', ev => {
        ev.preventDefault();

        // —Å–æ–∑–¥–∞—ë–º FormData –∏–∑ —Ñ–æ—Ä–º—ã
        const fd = new FormData(postForm);

        // –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ ‚Äî –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –≤ JSON-—Ñ–æ—Ä–º–∞—Ç–µ
        const data = {
            email: postForm.email.value,
            password: postForm.password.value,
        };

        console.log('data', data);

        fetch('https://httpbin.org/post', {
            method: 'POST',
            // headers –º–æ–∂–Ω–æ –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å, –µ—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º FormData
            // body: JSON.stringify(data), // –¥–ª—è JSON
            body: fd, // –¥–ª—è FormData
        })
            .then(response => response.json())
            .then(data => alert(JSON.stringify(data.json || data.form, null, 2)));
    });

    // üìò –ò–¢–û–ì:
    // - –î–ª—è —Ñ–∞–π–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º FormData (–±—Ä–∞—É–∑–µ—Ä —Å–∞–º –¥–æ–±–∞–≤–∏—Ç –Ω—É–∂–Ω—ã–π Content-Type)
    // - –î–ª—è –æ–±—ã—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å JSON + 'Content-Type: application/json'
</script>

<hr>

<!-- ==================== –†–∞–∑–¥–µ–ª 3. –í–∞–ª–∏–¥–∞—Ü–∏—è ==================== -->

<h2>–ü—Ä–∏–º–µ—Ä –≤–∞–ª–∏–¥–∞—Ü–∏–∏ email</h2>

<form id="authForm">
    <label>
        Email:
        <input id="emailInput" type="text" autocomplete="off" name="email">
    </label>
    <span class="error" style="color: red; display: none;">–û—à–∏–±–∫–∞ ‚Äî email –∑–∞–Ω—è—Ç</span>
    <br>
    <label>
        –ü–∞—Ä–æ–ª—å:
        <input type="password" autocomplete="off" name="password">
    </label>

    <button type="submit">Sign up</button>
</form>

<script>
    // üéì –ü—Ä–∏–º–µ—Ä 3: –ü—Ä–æ—Å—Ç–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
    // ---------------------------------------------------------------
    const emailInput = document.querySelector('#emailInput');
    const error = document.querySelector('.error');

    // —Å–æ–±—ã—Ç–∏–µ blur ‚Äî –∫–æ–≥–¥–∞ —ç–ª–µ–º–µ–Ω—Ç —Ç–µ—Ä—è–µ—Ç —Ñ–æ–∫—É—Å
    emailInput.addEventListener('blur', () => {
        if (emailInput.value === 'test@gmail.com') {
            error.style.display = 'inline';
        }
    });

    // –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ —Å–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
    emailInput.addEventListener('focus', () => {
        error.style.display = 'none';
    });
</script>

<!-- üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞:
–í–æ –≤–∫–ª–∞–¥–∫–µ Network –º–æ–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏, –æ—Ç–≤–µ—Ç—ã –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å, –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è.
–ú–æ–∂–Ω–æ —Ç–∞–∫–∂–µ –∑–∞–º–µ–¥–ª–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (3G/4G), —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ä–∞–±–æ—Ç—É –∑–∞–≥—Ä—É–∑—á–∏–∫–∞.
-->

</body>
</html>
